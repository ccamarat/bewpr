<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0070)file:///F:/Development/RI_Working/Prototypes/PostMessage/container.htm -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Origin tests</title>
<script>

// document.domain = "prototypes.prodemand.com";
var targetOrigin = 'http://iframe.prodemand.com';
var popup = 'http://prototypes.prodemand.com/PostMessage/example/popup.htm'

function postMessagePassthrough(s){
  var oFrame = document.getElementById("frmSub");
  try{
    oFrame.contentWindow.postMessage("Proxy'd Message:" + s, targetOrigin);  
    //alert("Message Sent to Target");
  }
  catch(e){
    alert("Message Failed? " + e.message);
  }
}

function stackbustPostMessagePassthrough(s){
  try {
    //alert("Setting a setTimeout() which will postMessage when timer expires.");
    strCode = 'postMessagePassthrough("'+s+'");';
    setTimeout(strCode, 0);
  }
  catch(e) {
    alert('stackbustPostMessagePassthrough error: ' + e.message);
  }
}

function openPopup(){
  window.open(popup, "thepopup", "left=0,top=0,height=300,width=400,status=yes,toolbar=no,menubar=no,location=yes" );
}

function trySend(){
  var oFrame = document.getElementById("frmSub");
  try {
    oFrame.contentWindow.postMessage("This is a message - " + new Date(), targetOrigin);  
    //alert("Message Sent to Target");
  }
  catch(e) {
    alert("Message Failed? " + e.message);
  }
}
document.write("Document Domain: " + document.domain + "<BR>");
</script>
<style type="text/css">
.style1 {
  font-size: x-small;
  font-weight: bold;
}
.style2 {
  font-size: x-small;
}
</style>
</head>

<body>
<button onclick="trySend();">Send Message to Child frame</button>
<button onclick="openPopup();">Create Popup</button><br>
<iframe width="800" id="frmSub" src="http://iframe.prodemand.com/PostMessage/example/target.htm" style="height: 400px; border: thin"></iframe>
<br>
<br>

</body></html>