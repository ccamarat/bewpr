<!DOCTYPE html>
<html>
<head>
  <title>Proxy Window</title>
  <style>
    iframe {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      border: 1px solid blue;
    }
  </style>
</head>
<body>
  <iframe id="server" seamless></iframe>
  <script src="json3.js"></script>
  <script>
    var oFrame = document.getElementById('server');

    // -----------------------------------------------
    // handle messages coming from the server
    // -----------------------------------------------
    function passthrough(e) {
      window.opener.postMessagePassthrough(e, '*');
    }
    if (document.addEventListener) {
      window.addEventListener('message', passthrough, false);
    }
    else if (window.attachEvent) {
      window.attachEvent('onmessage', passthrough);
    }

    // -----------------------------------------------
    // handle messages coming from the client
    // -----------------------------------------------
    // *** IE Compatibility ***
    function postMessagePassthrough(s) {
      // oFrame.contentWindow.postMessagePassthrough(s)
      oFrame.contentWindow.postMessage(s, "*");
    }

    // *** IE8 Compatibility ***
    function postMessagePassthroughStackbust(s) {
      // setTimeout('postMessagePassthrough("' + s + '")', 0);
      setTimeout(function() {postMessagePassthrough(s);}, 0);
    }

    // Update iFrame source
    (function() {
     var q = window.location.search;
     oFrame.name = window.name;
     oFrame.src = q.substring(q.indexOf('=') + 1);
    }());
  </script>
</body>
</html>
