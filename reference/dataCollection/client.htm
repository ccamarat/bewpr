<!DOCTYPE html>
<html>
<head>
    <title>Client Window</title>
</head>
<body>
    <h1>Client</h1>
    <button onclick="sendPostMessageToChild();">Send Message to Child via PostMessage</button><br />
    <button onclick="sendPostMessageToChildStackbust();">Send Message to Child via PostMessageStackbust</button><br />
    <button onclick="sendPostMessagePassthroughToChild();">Send Message to Child via PostMessagePassthrough</button><br />
    <!-- <button onclick="sendPostMessagePassthroughStackbustToChild();">Send Message to Child via PostMessagePassthroughStackbust</button><br /> -->

    <hr />
    <button onclick="openPopup();">Create Proxy</button><br />
    <div id="divMsgs"></div>

    <script>
        var proxy;
        var proxyUrl = 'http://popups.prodemand.com/PostMessage/dataCollection/proxy.htm';
        var oDiv = document.getElementById('divMsgs');
        function logMessage(e) {
            oDiv.innerHTML += "<b>" + e.origin + " says:</b> " + e.data + "<br/>";
        }
        function openPopup() {
            proxy = window.open(proxyUrl, "IntegrationServicesProxy", "left=0,top=0,height=900,width=800,status=yes,toolbar=no,menubar=no,location=yes");
        }

        // senders

        // *** postMessage ***
        sendPostMessageToChild = function (s) {
            proxy.postMessage(s || ("Source: <b>Client</b>. Domain: " + document.domain + ". <b>Via</b>: postMessage"), "*");
        }
        // *** postMessageStackbust ***
        sendPostMessageToChildStackbust = function () {
            var msg = "Source: <b>Client</b>. Domain: " + document.domain + ". <b>Via</b>: postMessageStackbust";
            setTimeout('sendPostMessageToChild("' + msg + '")', 0);
        }

        // *** postMessagePassthrough ***
        sendPostMessagePassthroughToChild = function () {
            proxy.postMessagePassthrough("Source: <b>Client</b>. Domain: " + document.domain + ". <b>Via</b>: postMessagePassthrough", "*");
        }

        // *** postMessagePassthroughStackbust ***
        sendPostMessagePassthroughStackbustToChild = function () {
            proxy.postMessagePassthroughStackbust("Source: <b>Client</b>. Domain: " + document.domain + ". <b>Via</b>: postMessagePassthroughStackbust", "*");
        }

        // Receivers

        // *** postMessage ***
        if (document.addEventListener) {
            window.addEventListener("message", logMessage, false);
        }
        else if (window.attachEvent) {
            window.attachEvent('onmessage', logMessage);
        }

        // *** postMessagePassthrough ***
        function postMessagePassthrough(s) {
            oDiv.innerHTML += s + "<br/>";
        }

        // *** postMessagePassthroughStackbust ***
        function postMessagePassthroughStackbust(s) {
            strCode = 'postMessagePassthrough("' + s + '");';
            setTimeout(strCode, 0);
        }
    </script>
</body>
</html>
